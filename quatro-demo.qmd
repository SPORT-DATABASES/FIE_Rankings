---
title: "Fencing Rankings Report"
author: "Your Name"
format: 
  pdf:
    output-file: report.pdf
params:
  country: "All"
execute:
  echo: false
  warning: false
  message: false
---

```{python, include=False}
import pandas as pd
from datetime import datetime

# Parameters
country = ["QATAR", "UNITED ARAB EMIRATES"]

# Load the data
rankings_df = pd.read_csv("Ranking_data.csv")

# Filter by country if specified
if country != "All":
    rankings_df = rankings_df[rankings_df['Country'] == country]

# Generate summary table
rankings_df = rankings_df[['Name', 'Rank', 'Points', 'Gender', 'Level', 'Weapon', 'Type']].drop_duplicates()

# Split into individuals and teams
individuals_df = rankings_df[rankings_df['Type'] == 'Individual']
teams_df = rankings_df[rankings_df['Type'] == 'Team']

# Sort the DataFrames: Men first, then Women; Seniors first, then Juniors
for df in [individuals_df, teams_df]:
    df['Gender'] = pd.Categorical(df['Gender'], categories=['Men', 'Women'], ordered=True)
    df['Level'] = pd.Categorical(df['Level'], categories=['Senior', 'Junior'], ordered=True)
    df.sort_values(by=['Gender', 'Level', 'Weapon'], inplace=True)

# Get the current date
update_date = datetime.now().strftime('%Y-%m-%d')

# Helper function to create markdown tables
def df_to_markdown_table(df):
    return df.to_markdown(index=False)

individual_tables = []
for (gender, level, weapon), group in individuals_df.groupby(['Gender', 'Level', 'Weapon'], observed=True):
    title = f"### {weapon} - {gender} - {level}"
    table = df_to_markdown_table(group[['Name', 'Rank', 'Points', 'Level', 'Weapon']])
    individual_tables.append((title, table))

team_tables = []
for (gender, level, weapon), group in teams_df.groupby(['Gender', 'Level', 'Weapon'], observed=True):
    title = f"### {weapon} - {gender} - {level}"
    table = df_to_markdown_table(group[['Name', 'Rank', 'Points', 'Level', 'Weapon']])
    team_tables.append((title, table))
```

## Individual Report

```{python, include=False}

from IPython.display import display, Markdown

for title, table in individual_tables:
    display(Markdown(title))
    display(Markdown(table))
```

## Team Reports

```{python, include=False}
from IPython.display import display, Markdown

for title, table in team_tables:
    display(Markdown(title))
    display(Markdown(table))
```


